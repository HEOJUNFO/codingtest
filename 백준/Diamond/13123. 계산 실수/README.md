# [Diamond IV] 계산 실수 - 13123 

[문제 링크](https://www.acmicpc.net/problem/13123) 

### 성능 요약

메모리: 40304 KB, 시간: 600 ms

### 분류

자료 구조, 세그먼트 트리

### 제출 일자

2025년 2월 11일 09:48:05

### 문제 설명

<p>수찬이는 수학 시험을 칠 때 문제를 다 풀어놓고 덧셈 또는 뺄셈을 잘못 하여 문제를 틀려버리는 안타까운 상황을 많이 경험한 바 있다. 예를 들어, 지난 7월 6일 시행된 2016학년도 7월 고3 전국연합학력평가의 수학 가형 시험에서, 그는 아래와 같이 뺄셈을 잘못하여 상당히 쉬운 문제를 틀렸다고 한다.</p>

<p style="text-align:center"><img alt="" src="https://onlinejudgeimages.s3-ap-northeast-1.amazonaws.com/problem/13123/fig1.png" style="height:399px; width:376px"></p>

<p style="text-align:center">무엇이 잘못되었을까?</p>

<p>어떻게 하면 이렇게 허무한 실수를 하지 않을지 고심하던 그는, 문득 계산은 계산기가 자신보다 훨씬 잘 한다는 것을 깨달았고, 덧셈 또는 뺄셈을 해야 할 때마다 계산기를 두드려 답을 찾으면 실수를 하지 않을 것이라고 생각하였다. 수찬이는 그 다음 날 계산기를 구매하였고, 계산을 할 일이 생길 때마다 계산기를 사용하며 실수를 하지 않는 자신의 모습에 흡족해했다.</p>

<p>잠시 수찬이가 사용하는 계산기에 대해 알아보자. 수찬이는 덧셈과 뺄셈만 하면 되기 때문에, 계산기는 아래 그림과 같이 계산 과정을 보여주는 화면과 입력을 위한 버튼들로만 구성된, 아주 단순한 구조이다.</p>

<p style="text-align:center"><img alt="" src="https://onlinejudgeimages.s3-ap-northeast-1.amazonaws.com/problem/13123/fig2.png" style="height:144px; width:117px"></p>

<p style="text-align:center">수찬이의 계산기</p>

<p>계산하는 방법 역시 간단하다. 숫자를 나타내는 버튼들(‘<code>0</code>’-‘<code>9</code>’)과 연산 기호(‘<code>+</code>’, ‘<code>-</code>’)를 나타내는 버튼들을 가지고 수식을 입력한 후, ‘<code>=</code>’ 버튼을 누르면 계산 결과를 알 수 있다. 초기화 버튼 ‘<code>AC</code>’를 누르면 계산기의 전체 상태가 처음 상태로 초기화된다. 계산기의 화면은, 숫자를 입력할 때에는 현재 입력되고 있는 수의 값을 보여주고, 연산 기호를 입력했을 때에는 현재까지의 계산 결과를 보여준다. 수찬이의 계산기는 완벽하기에, 수의 범위에는 제한이 없으며, 0으로 시작하는 수를 입력해도 관계 없다. 다만, 연산 기호를 잘못 입력하는 실수를 방지하기 위해, 연산 기호가 연속해서 나올 경우 <em>가장 나중에 나온 것</em>만을 취하고, 수식이 연산 기호로 시작할 경우 <em>앞에 0을 붙였다고 가정</em>하며, 수식이 연산 기호로 끝날 경우 <em>무시</em>한다.</p>

<p>예를 들어, ‘<code>-15+0035-+-3-</code>’을 계산기에 순서대로 입력하고, 마지막에 ‘=’ 버튼을 누르는 과정을 표로 나타내면 다음과 같다.</p>

<p style="text-align:center"><img alt="" src="https://onlinejudgeimages.s3-ap-northeast-1.amazonaws.com/problem/13123/1.png" style="height:300px; width:283px"></p>

<p style="text-align:center">‘<code>-15+0035-+-3-</code>’를 계산기에 입력하는 과정</p>

<p>이 설명을 본 여러분은 당연히 수찬이가 사용하는 계산기가 완벽하다고 생각할 것이다. 수찬이도 처음에는 그렇게 생각했으나, 계산기를 오랫동안 사용하면서 작은 문제점을 하나 발견하였다. 그 문제점은, 수찬이의 계산기에는 다른 계산기와는 달리 현재 입력하고 있는 수만을 초기화시키는 ‘<code>C</code>’ 버튼이 없기에, 계산기에 숫자를 잘못 입력했을 때에는 ‘<code>AC</code>’ 버튼을 눌러 수식을 처음부터 다시 입력할 수밖에 없어 시간 낭비가 심하다는 것이다.</p>

<p>불편해도 꾹 참고 계산기를 사용할 수도 있겠지만, 편리함을 추구하는 수찬이는 다음과 같은 자료구조를 구현하여 고난에서 벗어나고자 한다.</p>

<hr>
<p>‘<code>0</code>’, ‘<code>1</code>’, ‘<code>2</code>’, ‘<code>3</code>’, ‘<code>4</code>’, ‘<code>5</code>’, ‘<code>6</code>’, ‘<code>7</code>’, ‘<code>8</code>’, ‘<code>9</code>’, ‘<code>+</code>’, ‘<code>-</code>’로만 이루어진, 길이가 <em>N</em>인 문자열 <em>S</em>가 있다.</p>

<p>편의상 어떤 문자열 <em>X</em>에 대해 <em>X</em>[<em>i</em>..<em>j</em>]를 <em>X</em>의 <em>i</em>번째 문자, (<em>i</em> + 1)번째 문자, ..., (<em>j</em> − 1)번째 문자, <em>j</em>번째 문자를 이어 붙인 부분문자열로 정의하자. (단 1 ≤ <em>i</em> ≤ <em>j</em> ≤ |<em>X</em>|)</p>

<p>이때 아래의 두 연산을 지원하는 자료구조를 구현하라.</p>

<ol>
	<li>바꾸기: <em>S</em>[<em>a</em>..<em>b</em>]를 길이가 <em>b</em> − <em>a</em> + 1인 새로운 문자열 <em>T</em>로 대체하라. 다시 말해, 모든 <em>a</em> ≤ <em>i</em> ≤ <em>b</em>에 대해 <em>S</em>[<em>i</em>]의 값을 <em>T</em>[<em>i</em> − <em>a</em> + 1]로 바꿔라.</li>
	<li>계산하기: ‘<code>AC</code>’ 버튼을 누른 후, <em>S</em>[<em>a</em>..<em>b</em>]를 계산기에 입력하고, ‘<code>=</code>’ 버튼을 눌렀을 때 계산기의 화면에 보이는 계산 결과를 구하라.</li>
</ol>

### 입력 

 <p>첫 번째 줄에 문자열의 길이 <em>N</em> (1 ≤ <em>N</em> ≤ 200 000)이 주어진다.</p>

<p>두 번째 줄에 문자열 <em>S</em>가 주어진다. <em>S</em>의 길이는 <em>N</em>임이 보장된다.</p>

<p>세 번째 줄에 질의의 수 <em>Q</em> (1 ≤ <em>Q</em> ≤ 300 000)가 주어진다.</p>

<p>다음 <em>Q</em>개의 줄에는 연산의 정보가 주어진다. 각 줄의 입력 형식은 아래와 같다.</p>

<ul>
	<li>‘바꾸기’ 연산을 한다면, “1 <em>a</em> <em>b</em> <em>T</em>”와 같은 형식으로 입력이 주어진다. 이때 <em>a</em>, <em>b</em>는 정수이며 1 ≤ <em>a</em> ≤ <em>b</em> ≤ <em>N</em>을 만족하고, <em>T</em>는 길이가 <em>b</em> − <em>a</em> + 1인 문자열이다. 모든 ‘바꾸기’ 연산에서 주어지는 문자열 <em>T</em>의 길이의 합은 200 000 이하임이 보장된다.</li>
	<li>‘계산하기’ 연산을 한다면, “2 <em>a</em> <em>b</em>”와 같은 형식으로 입력이 주어진다. 이때 <em>a</em>, <em>b</em>는 정수이며 1 ≤ <em>a</em> ≤ <em>b</em> ≤ <em>N</em>을 만족한다. 적어도 하나의 ‘계산하기’ 연산이 주어짐이 보장된다.</li>
</ul>

<p>주어지는 모든 문자열은 ‘<code>0</code>’, ‘<code>1</code>’, ‘<code>2</code>’, ‘<code>3</code>’, ‘<code>4</code>’, ‘<code>5</code>’, ‘<code>6</code>’, ‘<code>7</code>’, ‘<code>8</code>’, ‘<code>9</code>’, ‘<code>+</code>’, ‘<code>-</code>’로만 이루어져 있음이 보장된다.</p>

### 출력 

 <p>‘계산하기’ 연산이 주어질 때마다 계산 결과를 10<sup>9</sup> + 7로 나눈 나머지를 한 줄에 하나씩 출력한다. 어떤 정수 <em>x</em>를 10<sup>9</sup> + 7로 나눈 나머지는, 두 정수 <em>q</em>와 <em>r</em>(0 ≤ <em>r</em> < 10<sup>9</sup> + 7)이 <em>x</em> = <em>q</em> ·(10<sup>9</sup> + 7) + <em>r</em>를 만족할 때, <em>r</em>의 값이다.</p>

